= render 'new_client_modal'
= simple_form_for @meeting do |f|

  - if @meeting.errors.any?
    #error_explanation
      %h2
        = pluralize(@meeting.errors.count, "error")
        prohibited this sales_rep from being saved:
      %ul
        - @meeting.errors.full_messages.each do |msg|
          %li= msg

  .row
    .col-lg-6
      .row
        .col-lg-5          
          %h4 This meeting is made for :         
        .col-lg-7
          = f.input :client_id, collection:(Client.all),label: false ,input_html: { class: 'form-control' }
    .col-lg-6     
      = link_to 'New Client', 
                new_client_path, {class:"btn btn-primary btn-lg", 
                                  :'data-remote'=>true }
  %hr

  .row
    .col-lg-3
      = f.input :start_date,:input_html =>{ class: 'form-control'}
    .col-lg-2  
      = f.input :duration, :collection => (Meeting::DURATION),:input_html =>{ class: 'form-control'}
    .col-lg-4 
      = f.input :memo, as: :text ,:input_html => { :rows => 2 , class: 'form-control'}
  %hr

  .row
    .col-lg-6
      %h4 Assign Sales Reps:
      - for sr in SalesRep.all
        = check_box_tag "sales_reps_ids[]" ,sr.id , @meeting.sales_reps.include?(sr)
        = sr.first_name
        %br     
    .col-lg-6       
      %h4 Assign Contacts:
      #container.hide        
        =link_to image_tag("ajax-loader.gif")

      #checkboxes
                
        -if @contacts.nil?
          %p Please Select a Client.
        -else
          - for c in @contacts
            = check_box_tag "contact_ids[]", c.id, @meeting.contacts.include?(c)
            = c.first_name
            %br
      %button#addContact.btn{type: "button"} Add contact
      %br
      = render 'contact_fields'
             
  %hr      
 


  %h4 Any follow Ups ?
  
  = f.simple_fields_for :follow_ups do |ff|
    .row
      .col-lg-2
        = ff.input :type, collection: (FollowUp::TYPES), required: false ,:input_html =>{ class: 'form-control'} 
     
      .col-lg-2
        = ff.input :due_date , required: false, disabled: true,:input_html =>{ class: 'form-control'} ,
          hint: 'Only the assigned user can estimate the Due date.'
      .col-lg-2
        = ff.input :complete_date, required: false ,:input_html =>{ class: 'form-control'} 
      
      .col-lg-2
        = ff.input :sales_rep_id , label: "Assign to" , collection: (SalesRep.all),:input_html =>{ class: 'form-control'}   
      .col-lg-3
        = ff.input :memo, as: :text ,:input_html => {class: 'form-control', :rows => 3 } , required: false

  
  = f.button :submit




  :javascript
    $(document).ready(function (){
    // Caching the Variables .
      var loading         = $('#container');
      var checkboxes      = $('#checkboxes') ;
      var add_btn         = $('#addContact'); 
      var contacts_fields = $('#fields');
      var submit          = $('#submit');
      $('.alert').hide();

      contacts_fields.hide();
      add_btn.hide();

    // This button will Show the new Contact fields.
      add_btn.click(function() {        
        contacts_fields.slideDown();        
      });

    // This button will hide the new Contact fileds (cancel).
      $('#cancel').click(function() {
        contacts_fields.slideUp();
      });

    // This button will handle adding new contact submesion.
      submit.click(function() {
        var client_id    = $('#meeting_client_id').val();
        var first_name  = $('#first_name').val();
        var last_name   = $('#last_name').val();
        var dataString  =   client_id + first_name + " " + last_name  
        var jsonObject = { contact: { fn: first_name , ln: last_name }, c_id: client_id }

                      

        //alert(  first_name + " " + last_name + client_id ); 
        $.ajax({
          type: "PUT",
          url: '/clients/add_contacts/' + client_id ,
          data:   jsonObject  ,
          dataType: 'script' ,
         })
            //.done(function( msg ){
            //  alert( "Data Saved: " + msg.client );
              // contacts_fields.slideUp();
            // });

      });

      $('#meeting_client_id').change(function(){
        loading.removeClass("hide"); // The Ajax loader gif .
        checkboxes.empty();          // The div that contains the contacts.
        contacts_fields.hide();      // The div for adding new cotacts.         
        var state = this.value;      // The currently selected Client ID .
        if(state != "") 
          {            
            $.getJSON('/clients/client_contacts/' + state, function(data){              
              if( data["contacts"].length == [] ) 
              {  
                loading.addClass("hide");            
                checkboxes.text("No Any contacts for the selected client");
                add_btn.show();                
              }
              else {
                loading.addClass("hide");
                add_btn.hide();
                $.each(data.contacts, function () {
                var name = this.nf + " " + this.nl ;
                $('<input name="contact_ids[]" type="checkbox" value="'+this._id+'">'+name+'</option><br />').appendTo(checkboxes);               
                })
              }          
            })
          }
        else {
          loading.addClass("hide"); 
          checkboxes.text("Please select a client");
          add_btn.hide();
        }
        return false;
      })
    });

<!-- <%= f.collection_select :client_id, Client.all, :id, :name %> -->